<!DOCTYPE html>
<html>

<head lang="en">

<style>
    .big_button {
    width:100%;

    display:inline-block;
}
</style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>


{% if request.user.musician %}

<script>
window.onload = function() {
    if(!window.location.hash) {
        window.location = window.location + '#loaded';
        window.location.reload();
    }
};

function initGeolocation() {
    if (navigator && navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        } else {
            console.log('Geolocation is not supported');
        }
}
function errorCallback() {}
function successCallback(position) {
    var lat = position.coords.latitude.toString();
    var long = position.coords.longitude.toString();
    var coordinates = lat + ',' + long;
    console.log(coordinates);
    var coords = document.getElementById('coordinates');
    coords.value = coordinates;
    $.ajax({
        url: "{% url 'main:current' %}",
        type: 'POST',
        data: {
            coordinates: coordinates,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
    });

}

</script>

{% elif request.user.nonmusician %}

<script>
window.onload = function() {
    if(!window.location.hash) {
        window.location = window.location + '#loaded';
        window.location.reload();
    }
};

function initGeolocation() {
    if (navigator && navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        } else {
            console.log('Geolocation is not supported');
        }
}
function errorCallback() {}
function successCallback(position) {
    var lat = position.coords.latitude.toString();
    var long = position.coords.longitude.toString();
    var coordinates = lat + ',' + long;
    console.log(coordinates);
    var coords = document.getElementById('coordinates');
    coords.value = coordinates;
    $.ajax({
        url: "{% url 'main:non_current' %}",
        type: 'POST',
        data: {
            coordinates: coordinates,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
    });

}

</script>
{% endif %}


    <meta charset="UTF-8">
    <title>Main-Feed</title>





</head>

<body onload="javascript:initGeolocation()">


<div align="Center"><h1>CLEFF FEED</h1>


{% if request.user %}
    <h3>Whats going on {{ request.user.username }}?</h3>
{% endif %}
<div><a href="{% url 'main:home' %}"><button>Home</button></a></div>
</div>

{% if request.user.musician %}
<form action="{% url 'main:current' %}" method="POST" id="position_form" >
       {% csrf_token %}
        <label>
            <input name="position" type="hidden" id="coordinates">
        </label>
</form>
{% elif request.user.nonmusician %}
<form action="{% url 'main:current' %}" method="POST" id="position_form" >
       {% csrf_token %}
        <label>
            <input name="position" type="hidden" id="coordinates">
        </label>
</form>
{% endif %}

<br>

<div align="Center">

{% if request.user %}
    {% for com in comrades %}
        {% if com.latest_video %}
         <div>
             <iframe src="https://www.youtube.com/embed/{{ com.latest_video.embedded_code }}"
                 allowfullscreen></iframe>
         </div>

            {% if com.profile_image %}

            <div><p>User: {{ com.user.username }}
                <a href="{% url 'profiles:m_public_profile' com.user.pk %}">
                <img src="/static{{ com.profile_image.url }}" width="4%" /><p></a>
            <a href="{% url 'profiles:m_public_profile' com.user.pk %}">
                <div><button class="big_button" >Check out {{ com.user.username }}'s profile</button></div></a>

            {% else %}
                <div><p>User: {{ com.user.username }}</p>
            <a href="{% url 'profiles:m_public_profile' com.user.pk %}">
                <div><button class="big_button" >Check out {{ com.user.username }}'s profile</button></div></a>

            {% endif %}
            </div>


        {% endif %}
    {% endfor %}
{% endif %}
</div>




</body>
</html>